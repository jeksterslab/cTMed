---
title: "The Ornstein–Uhlenbeck Model"
author: "Ivan Jacob Agaloos Pesigan"
date: "2024-03-19"
bibliography: "vignettes.bib"
csl: https://raw.githubusercontent.com/citation-style-language/styles/master/apa.csl
nocite: |
  @RCoreTeam-2023
  @Ou-Hunter-Chow-2019
  @Chow-Losardo-Park-etal-2023
  @Uhlenbeck-Ornstein-1930
  @Chow-Ho-Hamaker-etal-2010
  @Deboeck-Preacher-2015
  @Oravecz-Tuerlinckx-Vandekerckhove-2011
output:
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{The Ornstein–Uhlenbeck Model}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---








```r
library(cTMed)
```

## Model

The measurement model is given by
\begin{equation}
  \mathbf{y}_{i, t}
  =
  \boldsymbol{\nu}
  +
  \boldsymbol{\Lambda}
  \boldsymbol{\eta}_{i, t}
  +
  \boldsymbol{\varepsilon}_{i, t},
  \quad
  \mathrm{with}
  \quad
  \boldsymbol{\varepsilon}_{i, t}
  \sim
  \mathcal{N}
  \left(
  \mathbf{0},
  \boldsymbol{\Theta}
  \right)
\end{equation}
where
$\mathbf{y}_{i, t}$,
$\boldsymbol{\eta}_{i, t}$,
and
$\boldsymbol{\varepsilon}_{i, t}$
are random variables
and
$\boldsymbol{\nu}$,
$\boldsymbol{\Lambda}$,
and
$\boldsymbol{\Theta}$
are model parameters.
$\mathbf{y}_{i, t}$
represents a vector of observed random variables,
$\boldsymbol{\eta}_{i, t}$
a vector of latent random variables,
and
$\boldsymbol{\varepsilon}_{i, t}$
a vector of random measurement errors,
at time $t$ and individual $i$.
$\boldsymbol{\nu}$
denotes a vector of intercepts,
$\boldsymbol{\Lambda}$
a matrix of factor loadings,
and
$\boldsymbol{\Theta}$
the covariance matrix of
$\boldsymbol{\varepsilon}$.

An alternative representation of the measurement error
is given by
\begin{equation}
  \boldsymbol{\varepsilon}_{i, t}
  =
  \boldsymbol{\Theta}^{\frac{1}{2}}
  \mathbf{z}_{i, t},
  \quad
  \mathrm{with}
  \quad
  \mathbf{z}_{i, t}
  \sim
  \mathcal{N}
  \left(
  \mathbf{0},
  \mathbf{I}
  \right)
\end{equation}
where
$\mathbf{z}_{i, t}$ is a vector of
independent standard normal random variables and
$\left( \boldsymbol{\Theta}^{\frac{1}{2}} \right) \left( \boldsymbol{\Theta}^{\frac{1}{2}} \right)^{\prime} = \boldsymbol{\Theta}$ .

The dynamic structure is given by
\begin{equation}
  \mathrm{d} \boldsymbol{\eta}_{i, t}
  =
  - \boldsymbol{\Phi}
  \left(
  \boldsymbol{\mu}
  -
  \boldsymbol{\eta}_{i, t}
  \right)
  \mathrm{d}t
  +
  \boldsymbol{\Sigma}^{\frac{1}{2}}
  \mathrm{d}
  \mathbf{W}_{i, t}
\end{equation}
where
$\boldsymbol{\mu}$
is the long-term mean or equilibrium level,
$- \boldsymbol{\Phi}$
is the rate of mean reversion,
determining how quickly the variable returns to its mean,
$\boldsymbol{\Sigma}$
is the matrix of volatility
or randomness in the process, and
$\mathrm{d}\boldsymbol{W}$
is a Wiener process or Brownian motion,
which represents random fluctuations.


```r
data("deboeck2015phi", package = "cTMed")
```



## Model Fitting using the `dynr` Package

### Prepare Data

Before fitting the model, we set a small $\Delta t$ and insert NAs on rows with missing observations.


```r
data <- dynUtils::InsertNA(
  data = deboeck2015,
  id = "id",
  time = "time",
  observed = c("x", "m", "y"),
  delta_t = 0.10,
  ncores = parallel::detectCores()
)
head(data)
#>   id time          x         m       y
#> 1  1  0.0 -0.5315017 0.6983597 2.17007
#> 2  1  0.1         NA        NA      NA
#> 3  1  0.2         NA        NA      NA
#> 4  1  0.3         NA        NA      NA
#> 5  1  0.4         NA        NA      NA
#> 6  1  0.5         NA        NA      NA
```


```r
library(dynr)
```


```r
dynr_data <- dynr.data(
  dataframe = data,
  id = "id",
  time = "time",
  observed = c("x", "m", "y")
)
```

### Prepare Initial Condition


```r
dynr_initial <- prep.initial(
  values.inistate = rep(x = 0, times = 3),
  params.inistate = c("mu0_1", "mu0_2", "mu0_3"),
  values.inicov = diag(3),
  params.inicov = matrix(
    data = c(
      "sigma0_11", "sigma0_12", "sigma0_13",
      "sigma0_12", "sigma0_22", "sigma0_23",
      "sigma0_13", "sigma0_23", "sigma0_33"
    ),
    nrow = 3
  )
)
```

### Prepare Measurement Model


```r
dynr_measurement <- prep.measurement(
  values.load = diag(3),
  params.load = matrix(data = "fixed", nrow = 3, ncol = 3),
  state.names = c("eta_x", "eta_m", "eta_y"),
  obs.names = c("x", "m", "y")
)
```

### Prepare Dynamic Process


```r
dynr_dynamics <- prep.formulaDynamics(
  formula = list(  
    eta_x ~ phi_11 * eta_x + phi_12 * eta_m + phi_13 * eta_y,
    eta_m ~ phi_21 * eta_x + phi_22 * eta_m + phi_23 * eta_y,
    eta_y ~ phi_31 * eta_x + phi_32 * eta_m + phi_33 * eta_y
  ),
  startval = c(
    phi_11 = -0.357, phi_12 = 0, phi_13 = 0,
    phi_21 = 0.771, phi_22 = -0.511, phi_23 = 0,
    phi_31 = -0.450, phi_32 = 0.729, phi_33 = -0.693
  ),
  isContinuousTime = TRUE
)
```

### Prepare Process Noise


```r
dynr_noise <- prep.noise(
  values.latent = 0.01 * diag(3),
  params.latent = matrix(
    data = c(
      "sigma_11", "sigma_12", "sigma_13",
      "sigma_12", "sigma_22", "sigma_23",
      "sigma_13", "sigma_23", "sigma_33"
    ),
    nrow = 3
  ),
  values.observed = matrix(data = 0, nrow = 3, ncol = 3),
  params.observed = matrix(data = "fixed", nrow = 3, ncol = 3)
)
```

### Prepare the Model


```r
model <- dynr.model(
  data = dynr_data,
  initial = dynr_initial,
  measurement = dynr_measurement,
  dynamics = dynr_dynamics,
  noise = dynr_noise,
  outfile = "ou.c"
)
```

Set lower and upper bounds to aid in optimization.


```r
lb <- ub <- rep(NA, times = length(model$xstart))
names(ub) <- names(lb) <- names(model$xstart)
lb[
  c(
    "phi_11",
    "phi_21",
    "phi_31",
    "phi_12",
    "phi_22",
    "phi_32",
    "phi_13",
    "phi_23",
    "phi_33"
  )
] <- -1.5
ub[
  c(
    "phi_11",
    "phi_21",
    "phi_31",
    "phi_12",
    "phi_22",
    "phi_32",
    "phi_13",
    "phi_23",
    "phi_33"
  )
] <- 1.5
model$lb <- lb
model$ub <- ub
```

<img src="fig-vignettes-ou-model-1.png" width="3300" />

### Fit the Model


```r
dynr_fit <- dynr.cook(
  model,
  debug_flag = TRUE,
  verbose = FALSE
)
#> [1] "Get ready!!!!"
#> using C compiler: ‘gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0’
#> Optimization function called.
#> Starting Hessian calculation ...
#> Finished Hessian calculation.
#> Original exit flag:  3 
#> Modified exit flag:  3 
#> Optimization terminated successfully: ftol_rel or ftol_abs was reached. 
#> Original fitted parameters:  -0.3537864 0.02461296 -0.01454772 0.7745076 
#> -0.4761682 0.01994299 -0.5347597 0.8321049 -0.7859372 -2.119013 -0.4472824 
#> 0.2237069 -1.895274 -0.4334241 -1.724992 -0.1065631 -0.384853 0.05342032 
#> -0.05236702 0.2034092 0.3107022 0.1075105 0.08245522 -0.2412857 
#> 
#> Transformed fitted parameters:  -0.3537864 0.02461296 -0.01454772 0.7745076 
#> -0.4761682 0.01994299 -0.5347597 0.8321049 -0.7859372 0.1201502 -0.05374106 
#> 0.02687843 0.1743146 -0.07715598 0.2124178 -0.1065631 -0.384853 0.05342032 
#> 0.9489805 0.1930314 0.2948503 1.152767 0.1517894 0.8847984 
#> 
#> Doing end processing
#> Successful trial
#> Total Time: 1.525935 
#> Backend Time: 1.518218
```

## Summary


```r
summary(dynr_fit)
#> Coefficients:
#>            Estimate Std. Error t value  ci.lower  ci.upper Pr(>|t|)    
#> phi_11    -0.353786   0.052003  -6.803 -0.455710 -0.251863   <2e-16 ***
#> phi_12     0.024613   0.045599   0.540 -0.064760  0.113986   0.2947    
#> phi_13    -0.014548   0.045388  -0.321 -0.103507  0.074411   0.3743    
#> phi_21     0.774508   0.066547  11.639  0.644079  0.904936   <2e-16 ***
#> phi_22    -0.476168   0.058532  -8.135 -0.590890 -0.361447   <2e-16 ***
#> phi_23     0.019943   0.057695   0.346 -0.093137  0.133023   0.3648    
#> phi_31    -0.534760   0.080017  -6.683 -0.691589 -0.377930   <2e-16 ***
#> phi_32     0.832105   0.070598  11.787  0.693736  0.970474   <2e-16 ***
#> phi_33    -0.785937   0.068748 -11.432 -0.920680 -0.651194   <2e-16 ***
#> sigma_11   0.120150   0.011570  10.385  0.097474  0.142826   <2e-16 ***
#> sigma_12  -0.053741   0.011312  -4.751 -0.075913 -0.031569   <2e-16 ***
#> sigma_13   0.026878   0.012049   2.231  0.003262  0.050495   0.0129 *  
#> sigma_22   0.174315   0.018047   9.659  0.138942  0.209687   <2e-16 ***
#> sigma_23  -0.077156   0.016072  -4.801 -0.108657 -0.045655   <2e-16 ***
#> sigma_33   0.212418   0.022111   9.607  0.169082  0.255754   <2e-16 ***
#> mu0_1     -0.106563   0.137768  -0.773 -0.376584  0.163458   0.2196    
#> mu0_2     -0.384853   0.151837  -2.535 -0.682448 -0.087258   0.0057 ** 
#> mu0_3      0.053420   0.133026   0.402 -0.207305  0.314146   0.3440    
#> sigma0_11  0.948981   0.189785   5.000  0.577009  1.320952   <2e-16 ***
#> sigma0_12  0.193031   0.150412   1.283 -0.101770  0.487833   0.0997 .  
#> sigma0_13  0.294850   0.136129   2.166  0.028042  0.561658   0.0152 *  
#> sigma0_22  1.152767   0.230542   5.000  0.700914  1.604620   <2e-16 ***
#> sigma0_23  0.151789   0.144424   1.051 -0.131277  0.434856   0.1467    
#> sigma0_33  0.884798   0.176952   5.000  0.537980  1.231617   <2e-16 ***
#> ---
#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#> 
#> -2 log-likelihood value at convergence = 849.23
#> AIC = 897.23
#> BIC = 1041.78
```


```r
parnames <- c(
  "phi_11",
  "phi_21",
  "phi_31",
  "phi_12",
  "phi_22",
  "phi_32",
  "phi_13",
  "phi_23",
  "phi_33"
)
phi_vec <- coef(dynr_fit)[parnames]
phi <- matrix(
  data = phi_vec,
  nrow = 3
)
colnames(phi) <- rownames(phi) <- c("x", "m", "y")
vcov_phi_vec <- vcov(dynr_fit)[parnames, parnames]
dynr <- list(
  phi = phi,
  vcov = vcov_phi_vec
)
```



## Model Fitting using the `ctsem` Package

### Define the Model


```r
library(ctsem)
#> Loading required package: Rcpp
#> ctsem also changes in time, for manual run ctDocs(), for blog see https://cdriver.netlify.app/, for citation info run citation('ctsem'), for original OpenMx functionality install.packages('ctsemOMX'), and for discussion https://github.com/cdriveraus/ctsem/discussions
model <- ctModel(
  type = "stanct",
  manifestNames = c("x", "m", "y"),
  latentNames = c("eta_x", "eta_m", "eta_y"),
  id = "id",
  time = "time",
  silent = TRUE,
  LAMBDA = diag(3),
  DRIFT = "auto",
  MANIFESTMEANS = matrix(data = 0, nrow = 3, ncol = 1),
  MANIFESTVAR = diag(0, 3),
  CINT = "auto",
  DIFFUSION = "auto"
)
```

### Fit the Model


```r
set.seed(42)
ctsem_fit <- ctStanFit(
  datalong = data,
  ctstanmodel = model,
  optimize = TRUE,
  cores = parallel::detectCores()
)
#> Maximum likelihood estimation requested
#> Free T0VAR parameters as well as indvarying T0MEANS -- fixing T0VAR pars to diag matrix of 1e-3
#> Using 4/4 logical CPU cores
#> 1st pass optimization (carefulfit)...
#> Progress est. = 0%, LPchange = 54, Iter = 155, LP = -698.581443992392, worseCount = 0           Progress est. = 0.02%, LPchange = 54, Iter = 160, LP = -691.662922848019, worseCount = 1           Progress est. = 1.48%, LPchange = 48, Iter = 165, LP = -691.662922848019, worseCount = 0           Progress est. = 3.9%, LPchange = 39, Iter = 170, LP = -691.662922848019, worseCount = 1           Progress est. = 15.65%, LPchange = 14, Iter = 175, LP = -691.662922848019, worseCount = 2           Progress est. = 15.65%, LPchange = 14, Iter = 180, LP = -691.662922848019, worseCount = 3           Progress est. = 18.74%, LPchange = 11, Iter = 185, LP = -691.662922848019, worseCount = 4           Progress est. = 12.88%, LPchange = 18, Iter = 190, LP = -691.662922848019, worseCount = 5           Progress est. = 10.34%, LPchange = 22, Iter = 195, LP = -691.662922848019, worseCount = 6           Progress est. = 10.43%, LPchange = 22, Iter = 200, LP = -691.662922848019, worseCount = 7           Progress est. = 18.71%, LPchange = 11, Iter = 205, LP = -691.662922848019, worseCount = 8           Progress est. = 26.63%, LPchange = 5.5, Iter = 210, LP = -691.662922848019, worseCount = 9           Progress est. = 26.63%, LPchange = 5.5, Iter = 215, LP = -691.662922848019, worseCount = 10           Progress est. = 26.63%, LPchange = 5.5, Iter = 220, LP = -691.662922848019, worseCount = 11           Progress est. = 26.63%, LPchange = 5.5, Iter = 225, LP = -691.662922848019, worseCount = 12           Progress est. = 26.63%, LPchange = 5.5, Iter = 230, LP = -691.662922848019, worseCount = 13           Progress est. = 26.63%, LPchange = 5.5, Iter = 235, LP = -691.662922848019, worseCount = 14           Progress est. = 26.63%, LPchange = 5.5, Iter = 240, LP = -691.662922848019, worseCount = 15           Progress est. = 26.63%, LPchange = 5.5, Iter = 245, LP = -691.662922848019, worseCount = 16           Progress est. = 26.63%, LPchange = 5.5, Iter = 250, LP = -691.662922848019, worseCount = 17           Progress est. = 26.63%, LPchange = 5.5, Iter = 255, LP = -691.662922848019, worseCount = 18           Progress est. = 26.63%, LPchange = 5.5, Iter = 260, LP = -691.662922848019, worseCount = 19           Progress est. = 26.63%, LPchange = 5.5, Iter = 265, LP = -691.662922848019, worseCount = 20           
#> Converged -- count of non-improving iterations exceeded
#> Optimizing...
#> Progress est. = 0%, LPchange = 3.8, Iter = 31, LP = -508.341606563489Progress est. = 0.71%, LPchange = 3.4, Iter = 32, LP = -508.341606563489Progress est. = 0.93%, LPchange = 3.3, Iter = 33, LP = -501.396756521374Progress est. = 1.54%, LPchange = 3.1, Iter = 34, LP = -499.894314417657Progress est. = 1.18%, LPchange = 3.2, Iter = 35, LP = -487.592174749205Progress est. = 1.46%, LPchange = 3.1, Iter = 36, LP = -484.022041098282Progress est. = 1.84%, LPchange = 3, Iter = 37, LP = -482.26463327426Progress est. = 1.56%, LPchange = 3.1, Iter = 38, LP = -473.61995574082Progress est. = 0.98%, LPchange = 3.3, Iter = 39, LP = -461.94917244498Progress est. = 1.21%, LPchange = 3.2, Iter = 40, LP = -461.08918076325Progress est. = 0.79%, LPchange = 3.4, Iter = 41, LP = -452.794441349638Progress est. = 0.99%, LPchange = 3.3, Iter = 42, LP = -452.794441349638Progress est. = 1.17%, LPchange = 3.2, Iter = 43, LP = -452.794441349638Progress est. = 1.33%, LPchange = 3.2, Iter = 44, LP = -452.794441349638Progress est. = 1.49%, LPchange = 3.1, Iter = 45, LP = -452.794441349638Progress est. = 1.68%, LPchange = 3, Iter = 46, LP = -452.794441349638Progress est. = 1.87%, LPchange = 3, Iter = 47, LP = -452.794441349638Progress est. = 2.05%, LPchange = 2.9, Iter = 48, LP = -452.794441349638Progress est. = 2.22%, LPchange = 2.8, Iter = 49, LP = -452.794441349638Progress est. = 1.99%, LPchange = 2.9, Iter = 50, LP = -448.526578926377Progress est. = 2.14%, LPchange = 2.9, Iter = 51, LP = -448.526578926377Progress est. = 2.35%, LPchange = 2.8, Iter = 52, LP = -448.526578926377Progress est. = 2.64%, LPchange = 2.7, Iter = 53, LP = -448.526578926377Progress est. = 2.97%, LPchange = 2.6, Iter = 54, LP = -448.526578926377Progress est. = 3.29%, LPchange = 2.5, Iter = 55, LP = -448.526578926377Progress est. = 3.4%, LPchange = 2.4, Iter = 56, LP = -448.019900730304Progress est. = 3.06%, LPchange = 2.5, Iter = 57, LP = -444.767630342171Progress est. = 3.86%, LPchange = 2.3, Iter = 58, LP = -444.767630342171Progress est. = 3.63%, LPchange = 2.4, Iter = 59, LP = -442.773398828593Progress est. = 3.83%, LPchange = 2.3, Iter = 60, LP = -442.673088250846Progress est. = 4.17%, LPchange = 2.2, Iter = 61, LP = -442.154133861396Progress est. = 4.07%, LPchange = 2.2, Iter = 62, LP = -441.340994138647Progress est. = 4.93%, LPchange = 2, Iter = 63, LP = -441.340954289512Progress est. = 5.03%, LPchange = 2, Iter = 64, LP = -440.646787425264Progress est. = 6.78%, LPchange = 1.6, Iter = 65, LP = -440.271439210626Progress est. = 7.34%, LPchange = 1.5, Iter = 66, LP = -439.990455249076Progress est. = 7.59%, LPchange = 1.4, Iter = 67, LP = -439.620754722487Progress est. = 9.27%, LPchange = 1.1, Iter = 68, LP = -439.222875623105Progress est. = 12.39%, LPchange = 0.77, Iter = 69, LP = -438.908721796374Progress est. = 12.56%, LPchange = 0.75, Iter = 70, LP = -438.565806625228Progress est. = 15.92%, LPchange = 0.49, Iter = 71, LP = -438.153710300508Progress est. = 15.72%, LPchange = 0.5, Iter = 72, LP = -437.779744272314Progress est. = 15.55%, LPchange = 0.51, Iter = 73, LP = -437.435945993428Progress est. = 15.33%, LPchange = 0.53, Iter = 74, LP = -436.993627650013Progress est. = 15.12%, LPchange = 0.54, Iter = 75, LP = -436.574885762265Progress est. = 14.89%, LPchange = 0.56, Iter = 76, LP = -436.094484759516Progress est. = 14.63%, LPchange = 0.58, Iter = 77, LP = -435.525692377333Progress est. = 14.38%, LPchange = 0.59, Iter = 78, LP = -434.961510334762Progress est. = 14.12%, LPchange = 0.61, Iter = 79, LP = -434.353829199077Progress est. = 15.83%, LPchange = 0.49, Iter = 80, LP = -433.709163748094Progress est. = 15.47%, LPchange = 0.52, Iter = 81, LP = -433.010718948891Progress est. = 15.09%, LPchange = 0.54, Iter = 82, LP = -432.241470119016Progress est. = 14.7%, LPchange = 0.57, Iter = 83, LP = -431.402081190136Progress est. = 14.58%, LPchange = 0.58, Iter = 84, LP = -431.143326608395Progress est. = 14.58%, LPchange = 0.58, Iter = 85, LP = -431.143326608395Progress est. = 14.81%, LPchange = 0.56, Iter = 86, LP = -431.143326608395Progress est. = 16.48%, LPchange = 0.45, Iter = 87, LP = -431.143326608395Progress est. = 16.48%, LPchange = 0.45, Iter = 88, LP = -431.143326608395Progress est. = 17.12%, LPchange = 0.42, Iter = 89, LP = -430.225699043686Progress est. = 16.72%, LPchange = 0.44, Iter = 90, LP = -429.459171674215Progress est. = 17.03%, LPchange = 0.42, Iter = 91, LP = -429.459171674215Progress est. = 17.55%, LPchange = 0.4, Iter = 92, LP = -429.459171674215Progress est. = 16.15%, LPchange = 0.47, Iter = 93, LP = -427.133555719275Progress est. = 16.54%, LPchange = 0.45, Iter = 94, LP = -427.133555719275Progress est. = 16.76%, LPchange = 0.44, Iter = 95, LP = -427.133555719275Progress est. = 16.93%, LPchange = 0.43, Iter = 96, LP = -427.133555719275Progress est. = 16.4%, LPchange = 0.46, Iter = 97, LP = -425.85757961544Progress est. = 16.63%, LPchange = 0.45, Iter = 98, LP = -425.85757961544Progress est. = 16.81%, LPchange = 0.44, Iter = 99, LP = -425.85757961544Progress est. = 16.77%, LPchange = 0.44, Iter = 100, LP = -425.432392891574Progress est. = 17.01%, LPchange = 0.42, Iter = 101, LP = -425.432392891574Progress est. = 17.25%, LPchange = 0.41, Iter = 102, LP = -425.432392891574Progress est. = 17.47%, LPchange = 0.4, Iter = 103, LP = -425.432392891574Progress est. = 17.76%, LPchange = 0.39, Iter = 104, LP = -425.432392891574Progress est. = 17.8%, LPchange = 0.38, Iter = 105, LP = -425.068623774549Progress est. = 18.13%, LPchange = 0.37, Iter = 106, LP = -425.068623774549Progress est. = 18.44%, LPchange = 0.35, Iter = 107, LP = -424.927981653322Progress est. = 18.86%, LPchange = 0.33, Iter = 108, LP = -424.927981653322Progress est. = 19.24%, LPchange = 0.32, Iter = 109, LP = -424.800618459769Progress est. = 19.79%, LPchange = 0.3, Iter = 110, LP = -424.800618459769Progress est. = 20.31%, LPchange = 0.28, Iter = 111, LP = -424.679521655631Progress est. = 21.07%, LPchange = 0.25, Iter = 112, LP = -424.679521655631Progress est. = 21.98%, LPchange = 0.22, Iter = 113, LP = -424.679521655631Progress est. = 22.29%, LPchange = 0.22, Iter = 114, LP = -424.679521655631Progress est. = 22.29%, LPchange = 0.22, Iter = 115, LP = -424.679521655631Progress est. = 22.29%, LPchange = 0.22, Iter = 116, LP = -424.679521655631Progress est. = 22.29%, LPchange = 0.22, Iter = 117, LP = -424.679521655631Progress est. = 22.29%, LPchange = 0.22, Iter = 118, LP = -424.679521655631Progress est. = 23.44%, LPchange = 0.19, Iter = 119, LP = -424.653215225107Progress est. = 24.6%, LPchange = 0.16, Iter = 120, LP = -424.653215225107Progress est. = 24.58%, LPchange = 0.16, Iter = 121, LP = -424.645706486034Progress est. = 24.58%, LPchange = 0.16, Iter = 122, LP = -424.645706486034Progress est. = 29.68%, LPchange = 0.083, Iter = 123, LP = -424.630769819436Progress est. = 29.68%, LPchange = 0.083, Iter = 124, LP = -424.630769819436Progress est. = 29.67%, LPchange = 0.083, Iter = 125, LP = -424.629205708589Progress est. = 29.67%, LPchange = 0.083, Iter = 126, LP = -424.629205708589Progress est. = 35.22%, LPchange = 0.041, Iter = 127, LP = -424.62858687607Progress est. = 35.22%, LPchange = 0.041, Iter = 128, LP = -424.62858687607Progress est. = 35.21%, LPchange = 0.041, Iter = 129, LP = -424.6272384116Progress est. = 38.51%, LPchange = 0.027, Iter = 130, LP = -424.6272384116Progress est. = 38.51%, LPchange = 0.027, Iter = 131, LP = -424.627106073014Progress est. = 38.51%, LPchange = 0.027, Iter = 132, LP = -424.627106073014Progress est. = 38.5%, LPchange = 0.027, Iter = 133, LP = -424.626007031813Progress est. = 38.5%, LPchange = 0.027, Iter = 134, LP = -424.626007031813Progress est. = 43.14%, LPchange = 0.015, Iter = 135, LP = -424.624368454761Progress est. = 43.13%, LPchange = 0.015, Iter = 136, LP = -424.623678893078Progress est. = 46.06%, LPchange = 0.01, Iter = 137, LP = -424.622478196213Progress est. = 46.04%, LPchange = 0.01, Iter = 138, LP = -424.621721169752Progress est. = 50.19%, LPchange = 0.006, Iter = 139, LP = -424.620806393018Progress est. = 50.16%, LPchange = 0.006, Iter = 140, LP = -424.620123628801Progress est. = 58.72%, LPchange = 0.002, Iter = 141, LP = -424.619378853674Progress est. = 58.63%, LPchange = 0.002, Iter = 142, LP = -424.618748049904Progress est. = 58.57%, LPchange = 0.002, Iter = 143, LP = -424.618225114341Progress est. = 58.5%, LPchange = 0.0021, Iter = 144, LP = -424.617658866862Progress est. = 58.43%, LPchange = 0.0021, Iter = 145, LP = -424.617118231396Progress est. = 58.38%, LPchange = 0.0021, Iter = 146, LP = -424.616714335377Progress est. = 58.33%, LPchange = 0.0021, Iter = 147, LP = -424.61630595069Progress est. = 58.29%, LPchange = 0.0021, Iter = 148, LP = -424.615963319428Progress est. = 62.38%, LPchange = 0.0013, Iter = 149, LP = -424.615653471541Progress est. = 62.33%, LPchange = 0.0013, Iter = 150, LP = -424.615400787745Progress est. = 64%, LPchange = 0.001, Iter = 151, LP = -424.615193992314Progress est. = 63.96%, LPchange = 0.001, Iter = 152, LP = -424.615041740168Progress est. = 69.12%, LPchange = 0.00053, Iter = 153, LP = -424.614951415155Progress est. = 69.1%, LPchange = 0.00053, Iter = 154, LP = -424.61490932407Progress est. = 69.91%, LPchange = 0.00048, Iter = 155, LP = -424.61490932407Progress est. = 69.91%, LPchange = 0.00048, Iter = 156, LP = -424.61490932407Progress est. = 70.25%, LPchange = 0.00046, Iter = 157, LP = -424.61490932407Progress est. = 70.25%, LPchange = 0.00046, Iter = 158, LP = -424.61490932407Progress est. = 71.06%, LPchange = 0.00041, Iter = 159, LP = -424.61490932407Progress est. = 71.06%, LPchange = 0.00041, Iter = 160, LP = -424.61490932407Progress est. = 71.14%, LPchange = 0.00041, Iter = 161, LP = -424.61490932407Progress est. = 71.14%, LPchange = 0.00041, Iter = 162, LP = -424.61490932407Progress est. = 71.88%, LPchange = 0.00037, Iter = 163, LP = -424.61490932407Progress est. = 71.88%, LPchange = 0.00037, Iter = 164, LP = -424.61490932407Progress est. = 73.12%, LPchange = 0.00032, Iter = 165, LP = -424.61490932407Progress est. = 73.71%, LPchange = 0.00029, Iter = 166, LP = -424.61490932407Progress est. = 74.86%, LPchange = 0.00025, Iter = 167, LP = -424.61490932407Progress est. = 75.68%, LPchange = 0.00023, Iter = 168, LP = -424.61490932407Progress est. = 76.8%, LPchange = 2e-04, Iter = 169, LP = -424.61490932407Progress est. = 77.76%, LPchange = 0.00017, Iter = 170, LP = -424.61490932407Progress est. = 78.96%, LPchange = 0.00015, Iter = 171, LP = -424.61490932407Progress est. = 80.15%, LPchange = 0.00013, Iter = 172, LP = -424.61490932407Progress est. = 81.27%, LPchange = 0.00011, Iter = 173, LP = -424.614900684774Progress est. = 82.72%, LPchange = 9.2e-05, Iter = 174, LP = -424.614900684774Progress est. = 84.33%, LPchange = 7.5e-05, Iter = 175, LP = -424.614876064932Progress est. = 85.88%, LPchange = 6.1e-05, Iter = 176, LP = -424.614876064932Progress est. = 87.47%, LPchange = 5e-05, Iter = 177, LP = -424.614806987366Progress est. = 89.49%, LPchange = 3.9e-05, Iter = 178, LP = -424.614806987366Progress est. = 91.87%, LPchange = 2.8e-05, Iter = 179, LP = -424.614801751441Progress est. = 94.61%, LPchange = 2e-05, Iter = 180, LP = -424.614801751441Progress est. = 97.48%, LPchange = 1.4e-05, Iter = 181, LP = -424.614779450847Progress est. = 100%, LPchange = 8.7e-06, Iter = 182, LP = -424.614779450847
#> Converged -- lp change within tol(1e-05)
#> Finishing optimization...
#> Estimating HessianEstimating Hessian, par 1,2%Estimating Hessian, par 2,4%Estimating Hessian, par 3,6%Estimating Hessian, par 4,8%Estimating Hessian, par 5,10%Estimating Hessian, par 6,12%Estimating Hessian, par 7,14%Estimating Hessian, par 8,16%Estimating Hessian, par 9,18%Estimating Hessian, par 10,20%Estimating Hessian, par 11,22%Estimating Hessian, par 12,25%Estimating Hessian, par 13,27%Estimating Hessian, par 14,29%Estimating Hessian, par 15,31%Estimating Hessian, par 16,33%Estimating Hessian, par 17,35%Estimating Hessian, par 18,37%Estimating Hessian, par 19,39%Estimating Hessian, par 20,41%Estimating Hessian, par 21,43%Estimating Hessian, par 22,45%Estimating Hessian, par 23,47%Estimating Hessian, par 24,50%Estimating Hessian, par 1,52%Estimating Hessian, par 2,54%Estimating Hessian, par 3,56%Estimating Hessian, par 4,58%Estimating Hessian, par 5,60%Estimating Hessian, par 6,62%Estimating Hessian, par 7,64%Estimating Hessian, par 8,66%Estimating Hessian, par 9,68%Estimating Hessian, par 10,70%Estimating Hessian, par 11,72%Estimating Hessian, par 12,75%Estimating Hessian, par 13,77%Estimating Hessian, par 14,79%Estimating Hessian, par 15,81%Estimating Hessian, par 16,83%Estimating Hessian, par 17,85%Estimating Hessian, par 18,87%Estimating Hessian, par 19,89%Estimating Hessian, par 20,91%Estimating Hessian, par 21,93%Estimating Hessian, par 22,95%Estimating Hessian, par 23,97%Estimating Hessian, par 24,100%
#> Computing posterior with 1000 samples
```

### Summary


```r
summary(ctsem_fit)
#> $residCovStd
#>       x     m     y
#> x 0.534 0.038 0.077
#> m 0.038 0.319 0.023
#> y 0.077 0.023 0.374
#> 
#> $resiCovStdNote
#> [1] "Standardised covariance of residuals"
#> 
#> $rawpopcorr
#>                        mean     sd    2.5%    50%  97.5%      z
#> T0m_eta_m__T0m_eta_x 0.1769 0.1390 -0.1004 0.1812 0.4235 1.2728
#> T0m_eta_y__T0m_eta_x 0.3104 0.1252  0.0472 0.3133 0.5396 2.4804
#> T0m_eta_y__T0m_eta_m 0.1412 0.1348 -0.1214 0.1409 0.4063 1.0471
#> 
#> $parmatrices
#>              matrix row col    Mean     sd    2.5%     50%   97.5%
#> 1           T0MEANS   1   1 -0.1024 0.1347 -0.3603 -0.1022  0.1619
#> 2           T0MEANS   2   1 -0.3784 0.1547 -0.6869 -0.3742 -0.0738
#> 3           T0MEANS   3   1  0.0544 0.1330 -0.2036  0.0531  0.3193
#> 4            LAMBDA   1   1  1.0000 0.0000  1.0000  1.0000  1.0000
#> 5            LAMBDA   1   2  0.0000 0.0000  0.0000  0.0000  0.0000
#> 6            LAMBDA   1   3  0.0000 0.0000  0.0000  0.0000  0.0000
#> 7            LAMBDA   2   1  0.0000 0.0000  0.0000  0.0000  0.0000
#> 8            LAMBDA   2   2  1.0000 0.0000  1.0000  1.0000  1.0000
#> 9            LAMBDA   2   3  0.0000 0.0000  0.0000  0.0000  0.0000
#> 10           LAMBDA   3   1  0.0000 0.0000  0.0000  0.0000  0.0000
#> 11           LAMBDA   3   2  0.0000 0.0000  0.0000  0.0000  0.0000
#> 12           LAMBDA   3   3  1.0000 0.0000  1.0000  1.0000  1.0000
#> 13            DRIFT   1   1 -0.3560 0.0522 -0.4659 -0.3521 -0.2670
#> 14            DRIFT   1   2  0.0226 0.0454 -0.0610  0.0229  0.1144
#> 15            DRIFT   1   3 -0.0134 0.0458 -0.1071 -0.0134  0.0759
#> 16            DRIFT   2   1  0.7736 0.0684  0.6401  0.7742  0.9086
#> 17            DRIFT   2   2 -0.4794 0.0617 -0.6110 -0.4764 -0.3733
#> 18            DRIFT   2   3  0.0201 0.0588 -0.0977  0.0189  0.1332
#> 19            DRIFT   3   1 -0.5316 0.0817 -0.6964 -0.5309 -0.3768
#> 20            DRIFT   3   2  0.8311 0.0742  0.6835  0.8304  0.9752
#> 21            DRIFT   3   3 -0.7885 0.0726 -0.9379 -0.7867 -0.6522
#> 31    MANIFESTMEANS   1   1  0.0000 0.0000  0.0000  0.0000  0.0000
#> 32    MANIFESTMEANS   2   1  0.0000 0.0000  0.0000  0.0000  0.0000
#> 33    MANIFESTMEANS   3   1  0.0000 0.0000  0.0000  0.0000  0.0000
#> 34             CINT   1   1  0.0000 0.0000  0.0000  0.0000  0.0000
#> 35             CINT   2   1  0.0000 0.0000  0.0000  0.0000  0.0000
#> 36             CINT   3   1  0.0000 0.0000  0.0000  0.0000  0.0000
#> 46         asymCINT   1   1  0.0000 0.0000  0.0000  0.0000  0.0000
#> 47         asymCINT   2   1  0.0000 0.0000  0.0000  0.0000  0.0000
#> 48         asymCINT   3   1  0.0000 0.0000  0.0000  0.0000  0.0000
#> 49 asymDIFFUSIONcov   1   1  0.1781 0.0201  0.1420  0.1774  0.2197
#> 50 asymDIFFUSIONcov   1   2  0.1088 0.0244  0.0690  0.1065  0.1648
#> 51 asymDIFFUSIONcov   1   3  0.0196 0.0166 -0.0100  0.0188  0.0543
#> 52 asymDIFFUSIONcov   2   1  0.1088 0.0244  0.0690  0.1065  0.1648
#> 53 asymDIFFUSIONcov   2   2  0.3663 0.0440  0.2896  0.3630  0.4636
#> 54 asymDIFFUSIONcov   2   3  0.1500 0.0291  0.1017  0.1472  0.2183
#> 55 asymDIFFUSIONcov   3   1  0.0196 0.0166 -0.0100  0.0188  0.0543
#> 56 asymDIFFUSIONcov   3   2  0.1500 0.0291  0.1017  0.1472  0.2183
#> 57 asymDIFFUSIONcov   3   3  0.2813 0.0279  0.2320  0.2797  0.3425
#> 58     DIFFUSIONcov   1   1  0.1206 0.0119  0.0994  0.1198  0.1469
#> 59     DIFFUSIONcov   1   2 -0.0538 0.0113 -0.0767 -0.0533 -0.0333
#> 60     DIFFUSIONcov   1   3  0.0267 0.0120  0.0025  0.0264  0.0501
#> 61     DIFFUSIONcov   2   1 -0.0538 0.0113 -0.0767 -0.0533 -0.0333
#> 62     DIFFUSIONcov   2   2  0.1753 0.0190  0.1422  0.1738  0.2148
#> 63     DIFFUSIONcov   2   3 -0.0772 0.0164 -0.1092 -0.0764 -0.0482
#> 64     DIFFUSIONcov   3   1  0.0267 0.0120  0.0025  0.0264  0.0501
#> 65     DIFFUSIONcov   3   2 -0.0772 0.0164 -0.1092 -0.0764 -0.0482
#> 66     DIFFUSIONcov   3   3  0.2137 0.0225  0.1749  0.2123  0.2582
#> 67      MANIFESTcov   1   1  0.0000 0.0000  0.0000  0.0000  0.0000
#> 68      MANIFESTcov   1   2  0.0000 0.0000  0.0000  0.0000  0.0000
#> 69      MANIFESTcov   1   3  0.0000 0.0000  0.0000  0.0000  0.0000
#> 70      MANIFESTcov   2   1  0.0000 0.0000  0.0000  0.0000  0.0000
#> 71      MANIFESTcov   2   2  0.0000 0.0000  0.0000  0.0000  0.0000
#> 72      MANIFESTcov   2   3  0.0000 0.0000  0.0000  0.0000  0.0000
#> 73      MANIFESTcov   3   1  0.0000 0.0000  0.0000  0.0000  0.0000
#> 74      MANIFESTcov   3   2  0.0000 0.0000  0.0000  0.0000  0.0000
#> 75      MANIFESTcov   3   3  0.0000 0.0000  0.0000  0.0000  0.0000
#> 76            T0cov   1   1  0.9722 0.1960  0.6443  0.9563  1.4040
#> 77            T0cov   1   2  0.1924 0.1556 -0.0977  0.1904  0.4990
#> 78            T0cov   1   3  0.2923 0.1370  0.0405  0.2856  0.5853
#> 79            T0cov   2   1  0.1924 0.1556 -0.0977  0.1904  0.4990
#> 80            T0cov   2   2  1.1803 0.2451  0.7651  1.1536  1.7100
#> 81            T0cov   2   3  0.1464 0.1433 -0.1162  0.1390  0.4488
#> 82            T0cov   3   1  0.2923 0.1370  0.0405  0.2856  0.5853
#> 83            T0cov   3   2  0.1464 0.1433 -0.1162  0.1390  0.4488
#> 84            T0cov   3   3  0.8933 0.1777  0.5984  0.8774  1.2681
#> 85          dtDRIFT   1   1  0.7086 0.0296  0.6475  0.7105  0.7632
#> 86          dtDRIFT   1   2  0.0111 0.0227 -0.0338  0.0115  0.0535
#> 87          dtDRIFT   1   3 -0.0072 0.0259 -0.0605 -0.0073  0.0435
#> 88          dtDRIFT   2   1  0.5090 0.0325  0.4437  0.5094  0.5708
#> 89          dtDRIFT   2   2  0.6298 0.0260  0.5757  0.6305  0.6780
#> 90          dtDRIFT   2   3  0.0068 0.0288 -0.0525  0.0071  0.0613
#> 91          dtDRIFT   3   1 -0.1155 0.0313 -0.1807 -0.1147 -0.0572
#> 92          dtDRIFT   3   2  0.4414 0.0251  0.3887  0.4424  0.4858
#> 93          dtDRIFT   3   3  0.4611 0.0285  0.4057  0.4608  0.5197
#> 
#> $popsd
#>             mean     sd   2.5%    50%  97.5%
#> T0m_eta_x 0.9824 0.1005 0.7957 0.9801 1.1853
#> T0m_eta_m 1.0803 0.1119 0.8744 1.0750 1.3144
#> T0m_eta_y 0.9399 0.0971 0.7600 0.9386 1.1294
#> 
#> $popmeans
#>                      mean     sd    2.5%     50%   97.5%
#> T0m_eta_x         -0.1024 0.1347 -0.3603 -0.1022  0.1619
#> T0m_eta_m         -0.3784 0.1547 -0.6869 -0.3742 -0.0738
#> T0m_eta_y          0.0544 0.1330 -0.2036  0.0531  0.3193
#> drift_eta_x       -0.3560 0.0522 -0.4659 -0.3521 -0.2670
#> drift_eta_x_eta_m  0.0226 0.0454 -0.0610  0.0229  0.1144
#> drift_eta_x_eta_y -0.0134 0.0458 -0.1071 -0.0134  0.0759
#> drift_eta_m_eta_x  0.7736 0.0684  0.6401  0.7742  0.9086
#> drift_eta_m       -0.4794 0.0617 -0.6110 -0.4764 -0.3733
#> drift_eta_m_eta_y  0.0201 0.0588 -0.0977  0.0189  0.1332
#> drift_eta_y_eta_x -0.5316 0.0817 -0.6964 -0.5309 -0.3768
#> drift_eta_y_eta_m  0.8311 0.0742  0.6835  0.8304  0.9752
#> drift_eta_y       -0.7885 0.0726 -0.9379 -0.7867 -0.6522
#> diff_eta_x         0.3469 0.0170  0.3152  0.3462  0.3832
#> diff_eta_m_eta_x  -0.1974 0.0349 -0.2647 -0.1980 -0.1252
#> diff_eta_m         0.4181 0.0226  0.3772  0.4169  0.4635
#> diff_eta_y_eta_x   0.0688 0.0364 -0.0072  0.0692  0.1403
#> diff_eta_y_eta_m  -0.2145 0.0370 -0.2867 -0.2146 -0.1439
#> diff_eta_y         0.4616 0.0242  0.4182  0.4607  0.5082
#> 
#> $popNote
#> [1] "popmeans are reported as specified in ctModel -- covariance related matrices are in sd / unconstrained correlation form -- see $parmatrices for simpler interpretations!"
#> 
#> $loglik
#> [1] -424.6148
#> 
#> $npars
#> [1] 24
#> 
#> $aic
#> [1] 897.2295
#> 
#> $logposterior
#> [1] -424.6148
```

### Extract the Posterior Distribution of the Drift Matrix


```r
posterior <- ctExtract(ctsem_fit)$pop_DRIFT
posterior_phi <- lapply(
  X = seq_len(dim(posterior)[1]),
  FUN = function(i) {
    phi <- posterior[i, , ]
    colnames(phi) <- rownames(phi) <- c("x", "m", "y")
    return(phi)
  }
)
posterior_phi_vec <- lapply(
  X = posterior_phi,
  FUN = function(i) {
    dim(i) <- NULL
    return(i)
  }
)
phi_vec <- colMeans(do.call(what = "rbind", args = posterior_phi_vec))
phi <- matrix(
  data = phi_vec,
  nrow = 3
)
colnames(phi) <- rownames(phi) <- c("x", "m", "y")
vcov_phi_vec <- var(do.call(what = "rbind", args = posterior_phi_vec))
ctsem <- list(
  posterior = posterior,
  posterior_phi = posterior_phi,
  phi = phi,
  vcov = vcov_phi_vec
)
```


```r
deboeck2015phi <- list(
  dynr = dynr,
  ctsem = ctsem
)
```



## References


